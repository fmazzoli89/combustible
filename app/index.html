<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Combustible</title>
    <link rel="stylesheet" href="css/styles.css">
    <style>
        #testArea {
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        #testButton {
            background-color: #f0ad4e;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
        }
        #testResults {
            margin-top: 10px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 5px;
            white-space: pre-wrap;
            font-family: monospace;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="tabs">
            <button class="tab-btn active" data-tab="carga">CARGA</button>
            <button class="tab-btn" data-tab="descarga">DESCARGA</button>
        </div>

        <div class="tab-content" id="carga">
            <form id="cargaForm">
                <div class="form-group">
                    <label for="cargaFecha">Fecha y hora</label>
                    <input type="datetime-local" id="cargaFecha" required>
                </div>

                <div class="form-group">
                    <label for="estacion">Estación</label>
                    <select id="estacion" required>
                        <option value="INTERCAR" selected>INTERCAR</option>
                        <option value="DEFLORES">DEFLORES</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="cargaLitros">Litros</label>
                    <input type="number" id="cargaLitros" max="700" required>
                </div>

                <button type="submit" class="btn-primary">CARGAR</button>
            </form>
        </div>

        <div class="tab-content hidden" id="descarga">
            <form id="descargaForm">
                <div class="form-group">
                    <label for="descargaFecha">Fecha y hora</label>
                    <input type="datetime-local" id="descargaFecha" required>
                </div>

                <div class="form-group">
                    <label for="obra">Obra</label>
                    <select id="obra" required>
                        <option value="OBRA 1">OBRA 1</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="maquina">Máquina</label>
                    <select id="maquina" required>
                        <option value="MAQUINA 1">MAQUINA 1</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="operario">Operario</label>
                    <select id="operario" required>
                        <option value="OPERARIO 1">OPERARIO 1</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="descargaLitros">Litros</label>
                    <input type="number" id="descargaLitros" max="400" required>
                </div>

                <div class="form-group">
                    <label for="horometro">Horómetro</label>
                    <input type="number" id="horometro" step="0.1" required>
                </div>

                <div class="form-group">
                    <label for="aceiteMotor">Aceite de motor (litros)</label>
                    <input type="number" id="aceiteMotor" value="0" step="0.1">
                </div>

                <div class="form-group">
                    <label for="aceiteHidraulico">Aceite hidráulico (litros)</label>
                    <input type="number" id="aceiteHidraulico" value="0" step="0.1">
                </div>

                <div class="form-group">
                    <label for="fluidina">Fluidina (litros)</label>
                    <input type="number" id="fluidina" value="0" step="0.1">
                </div>

                <button type="submit" class="btn-primary">DESCARGAR</button>
            </form>
        </div>
    </div>
    
    <div id="testArea">
        <h3>API Connection Test</h3>
        <button id="testButton" onclick="runConnectionTest()">Test API Connection</button>
        <div id="testResults"></div>
    </div>

    <script src="js/app.js"></script>
    <script src="js/sheets-test.js"></script>
    <script>
        // Test Google Sheets access on page load
        document.addEventListener('DOMContentLoaded', () => {
            testSheetsAccess().then(info => {
                console.log('Successfully connected to sheet:', info.properties.title);
            }).catch(error => {
                console.error('Failed to connect to sheet:', error);
            });
        });

        async function runConnectionTest() {
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML = 'Testing API connection...\n';
            
            try {
                // Test a simple fetch to the API endpoint
                resultsDiv.innerHTML += 'Sending request to API...\n';
                
                const response = await fetch('https://combustible-tramec.vercel.app/api/sheets-test', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ test: true })
                }).catch(error => {
                    resultsDiv.innerHTML += `Fetch error: ${error.message}\n`;
                    throw error;
                });
                
                resultsDiv.innerHTML += `Response status: ${response.status}\n`;
                
                const responseText = await response.text();
                resultsDiv.innerHTML += `Raw response: ${responseText}\n`;
                
                try {
                    const data = JSON.parse(responseText);
                    resultsDiv.innerHTML += `Parsed response: ${JSON.stringify(data, null, 2)}\n`;
                    
                    if (data.success) {
                        resultsDiv.innerHTML += 'Connection successful!\n';
                    } else {
                        resultsDiv.innerHTML += `Connection failed: ${data.message || 'Unknown error'}\n`;
                    }
                } catch (parseError) {
                    resultsDiv.innerHTML += `Error parsing response: ${parseError.message}\n`;
                }
            } catch (error) {
                resultsDiv.innerHTML += `Test failed: ${error.message}\n`;
            }
        }
    </script>
</body>
</html> 